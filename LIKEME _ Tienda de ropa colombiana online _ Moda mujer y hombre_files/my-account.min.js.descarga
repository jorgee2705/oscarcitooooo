define(['jquery','uiComponent','Magento_Customer/js/customer-data','mage/mage','collapsible'],function($,Component,customerData){'use strict';return Component.extend({defaults:{useCollapsibleLogout:false,mobileHideSubmenuDelay:0},collapsibleInitialized:false,collapsibleActionsRegistered:false,accountContainer:null,timeout:null,initialize:function(){this._super();this.customer=customerData.get('customer');this.customer.subscribe(function(){},this);this.bindCollapsibleActions();},initCollapsible:function(){if(!this.collapsibleInitialized&&((this.customer()&&this.customer().fullname)||this.useCollapsibleLogout)){if($('#header-my-account .mage-dropdown-dialog').length){$('#header-my-account .mage-dropdown-dialog .dropdown').dropdownDialog('destroy').remove();}
clearTimeout(this.timeout);var $accountContainer=$('#header-my-account .account-container');this.timeout=setTimeout(function(){$accountContainer.addClass('toggle-active').find('.dropdown').mage('dropdownDialog',{"appendTo":"#header-my-account .account-container","triggerTarget":"#header-my-account [data-role=trigger]","timeout":"0","closeOnMouseLeave":false,"closeOnEscape":true,"triggerClass":"active","parentClass":"active","bodyClass":"my-account-active","buttons":[]});this.bindCollapsibleActions();}.bind(this),200);this.collapsibleInitialized=true;}},afterDropdownRender:function(logged){if($('#header-my-account .mage-dropdown-dialog').length){$('#header-my-account .mage-dropdown-dialog .dropdown').dropdownDialog('destroy').remove();}
let dropdownSelector=(logged)?'.dropdown.logged':'.dropdown.not-logged';var $accountContainer=$('#header-my-account .account-container');$accountContainer.addClass('toggle-active').find(dropdownSelector).mage('dropdownDialog',{"appendTo":"#header-my-account .account-container","triggerTarget":"#header-my-account [data-role=trigger]","timeout":"0","closeOnMouseLeave":false,"closeOnEscape":true,"triggerClass":"active","parentClass":"active","bodyClass":"my-account-active","buttons":[]});this.bindCollapsibleActions();this.collapsibleInitialized=true;},bindCollapsibleActions:function(){if(!this.collapsibleActionsRegistered){this.collapsibleActionsRegistered=true;$('body').on('click','[data-role="my-account-trigger"]',function(e){if(this.collapsibleInitialized){e.preventDefault();if($('#header-my-account .account-container').hasClass('active')){setTimeout(function(){$('#header-my-account [data-role="trigger"]').first().click();},this.mobileHideSubmenuDelay);}else{$('#header-my-account [data-role="trigger"]').first().click();}}}.bind(this));}}});});
define(['jquery','mage/template','Magento_Customer/js/customer-data','Magento_Ui/js/modal/modal',"matchMedia",'jquery-ui-modules/widget','jquery/jquery-storageapi',],function($,mageTemplate,customerData,modal,mediaCheck){'use strict';$.widget('mage.productAddedModal',{options:{tmplSelector:'#product-added-modal-tmpl',modalSelector:'#product-added-modal',modalContentSelector:'#product-added-modal',modalTitle:'Product recently added to cart',storageKey:'product-added-modal-section-id',modalOptions:{type:"popup",modalClass:"product-added-modal",parentModalClass:"_has-product-added-shown",buttons:[]},cartButton:true,checkoutButton:true,mobileActive:true,mobileViewport:767,continueButtonText:'Continue shopping',cartButtonText:'View cart',checkoutButtonText:'Proceed to Checkout',},modal:null,cart:null,_create:function(){let self=this
this.options.modalOptions.title=this.options.modalTitle;if(this.options.checkoutButton||this.options.cartButton){this.options.modalOptions.buttons.push({text:this.options.continueButtonText,class:"action secondary cancel",click:function(){this.closeModal();}});if(this.options.cartButton){this.options.modalOptions.buttons.push({text:this.options.cartButtonText,class:"action primary cart",click:function(){this.closeModal();window.location.href=self.options.cartUrl;}});}
if(this.options.checkoutButton){this.options.modalOptions.buttons.push({text:this.options.checkoutButtonText,class:"action primary cart",click:function(){this.closeModal();window.location.href=self.options.checkoutUrl;}});}}
this.modal=modal(this.options.modalOptions,$(this.options.modalSelector));this.storage=$.localStorage;this.cart=customerData.get('cart');this.cart.subscribe(function(){if(this.validateSection()){this.triggerModal();}}.bind(this))},validateSection:function(){let isMobile=matchMedia("screen and (max-width:"+this.options.mobileViewport+"px)").matches,storageVersion=this.storage.get(this.options.storageKey);return this.cart()['product_added_modal']&&(!isMobile||(this.options.mobileActive&&isMobile))&&storageVersion!=this.cart()['data_id'];},triggerModal:function(){this.storage.set(this.options.storageKey,this.cart()['data_id']);$(this.options.modalContentSelector).html(this.getModalContent());this.modal.openModal();},getModalContent:function(){return $(mageTemplate(this.options.tmplSelector,{data:this.getTemplateData()}));},getTemplateData:function(){let itemKey=this.cart()['product_added_modal']['item_key'],itemData=this.cart()['items'][itemKey];if(this.cart()['product_added_modal']['crosssells']){itemData['crosssells']=this.cart()['product_added_modal']['crosssells'];}
return itemData;},getOptionValueUnsanitizedHtml:function(optionValue){return optionValue;}});return $.mage.productAddedModal;});
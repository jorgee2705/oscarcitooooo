define(["jquery","ko","uiComponent","Magento_Customer/js/customer-data","mage/mage","collapsible",],function($,ko,Component,customerData){"use strict";const CLASESS={apply:"action apply primary",cancel:"action cancel primary",},LABELS={cancel:"Cancel",apply:"Apply Discount",},MINICART_SECTION="minicart_coupon";return Component.extend({defaults:{activeCoupon:ko.observable(""),hasCouponCode:ko.observable(),enableInput:ko.observable(),enableButton:ko.observable(false),},initialize:function(config){this._super();this.minicartCoupon=customerData.get(MINICART_SECTION);const sessionCouponData=this.checkCouponCode(config.checkCouponUrl);const{coupon_code:sessionCouponCode,has_coupon:sessionHasCoupon,}=sessionCouponData;this.activeCoupon(sessionCouponCode);this.hasCouponCode(sessionHasCoupon);this.enableInput(!this.hasCouponCode());this.enableButton(!!this.activeCoupon());this.activeCoupon.subscribe((newValue)=>{this.enableButton(!!newValue);});this.form=$(config.formId);this.addedFormValidate(this.form);},checkCouponCode:function(uri){let couponData=$.ajax({showLoader:false,url:uri,async:false,type:"POST",}).done((data)=>{return data;}).fail(()=>{return{};});return couponData.responseJSON??{};},addedFormValidate:function(dataForm){let ignore=null;dataForm.mage("validation",{ignore:ignore?":hidden:not("+ignore+")":":hidden",}).find("input:text").attr("autocomplete","off");},handleClick:function(){let inputElem=$(this.inputcodeId);let isValid=$.validator.validateSingleElement(inputElem);if(isValid){this.form.submit();}},getClasses:function(){return this.hasCouponCode()?CLASESS.cancel:CLASESS.apply;},getLabel:function(){return this.hasCouponCode()?$.mage.__(LABELS.cancel):$.mage.__(LABELS.apply);},});});
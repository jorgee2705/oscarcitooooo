define(['jquery','Magento_Catalog/js/price-utils','jquery-ui-modules/widget'],function($,utils){"use strict";return function(target){$.widget('mage.priceBox',target,{specialPriceVisibilityElement:[],specialPriceLabelElement:[],priceFormat:false,_create:function(){this._super();this.specialPriceLabelElement=this.element.closest('.product-item, .product-info-container').find('.special-price-discount-label');if(this.specialPriceLabelElement.length){this.priceFormat=(this.options.priceConfig&&this.options.priceConfig.priceFormat)||{};this.specialPriceVisibilityElement=this.element.closest('.product-item, .product-info-container').find('.special-price-discount');this.specialPriceLabelPercentageElement=this.specialPriceLabelElement.filter('.show-pecentage');this.specialPriceLabelAmountElement=this.specialPriceLabelElement.filter('.show-amount');this.element.on('reloadPrice',this.updateSpecialPriceLabel.bind(this));}},updateSpecialPriceLabel:function(){if(this.cache.displayPrices&&this.cache.displayPrices.oldPrice&&this.cache.displayPrices.oldPrice.amount&&this.cache.displayPrices.finalPrice&&this.cache.displayPrices.finalPrice.amount&&this.cache.displayPrices.oldPrice.amount>this.cache.displayPrices.finalPrice.amount){let discountAmount,discountPercentage,discount=this.cache.displayPrices.oldPrice.amount-this.cache.displayPrices.finalPrice.amount;if(discount>0){discountPercentage=Math.round((discount)*100 / this.cache.displayPrices.oldPrice.amount);if(this.cache.displayPrices.finalPrice.amount&&discountPercentage==100){discountPercentage=99;}
discountAmount=utils.formatPrice(discount,this.priceFormat);if(this.specialPriceLabelAmountElement.length){this.specialPriceLabelAmountElement.text(this.specialPriceLabelAmountElement.first().attr('data-translate').replace('%1',discountAmount));}
if(this.specialPriceLabelPercentageElement.length){this.specialPriceLabelPercentageElement.text(this.specialPriceLabelPercentageElement.first().attr('data-translate').replace('%1',discountPercentage));}
this.specialPriceVisibilityElement.removeClass('no-display');}else{this.specialPriceVisibilityElement.addClass('no-display');}}else{this.specialPriceVisibilityElement.addClass('no-display');}}});return $.mage.priceBox;};});
define(["jquery","matchMedia",'jquery-ui-modules/widget'],function($,mediaCheck){"use strict";$.widget('mage.loadImages',{isMobile:false,delayExecuted:false,options:{delay:1500,useResponsive:true,mobileViewport:767,imageSelector:'[data-lazy], [data-lazy-mobile], [data-lazy-desktop]',normalAttribute:'data-lazy',mobileAttribute:'data-lazy-mobile',desktopAttribute:'data-lazy-desktop',deferClass:'defer-images-load',deferredClass:'images-deferred',checkVisibility:false},_create:function(){if(this.element.hasClass(this.options.deferClass)){return;}
this.element.addClass(this.options.deferClass);this.isMobile=matchMedia("screen and (max-width:"+this.options.mobileViewport+"px)").matches;this.options.useResponsive=(this.options.useResponsive)?true:(this.element.find('img['+this.options.desktopAttribute+'], img['+this.options.desktopAttribute+']').length);if(this.element.attr('data-defer-time')&&!isNaN(this.element.attr('data-defer-time'))){this.options.delay=this.element.attr('data-defer-time');}else{if(this.element.attr('data-delay')&&!isNaN(this.element.attr('data-delay'))){this.options.delay=this.element.attr('data-delay');}}
if(!isNaN(this.options.delay)){setTimeout($.proxy(this._loadImages,this),this.options.delay);}else{this._loadImages();}
this._bind();},_bind:function(){if(this.options.useResponsive||this.options.checkVisibility){mediaCheck({media:'(max-width: '+this.options.mobileViewport+'px)',entry:$.proxy(function(){this.isMobile=true;if(this.delayExecuted){this._loadImages();}},this),exit:$.proxy(function(){this.isMobile=false;if(this.delayExecuted){this._loadImages();}},this)});}},_loadImages:function(){this.delayExecuted=true;var $this=this;var images=(this.element.is('img'))?this.element:this.element.find(this.options.imageSelector);var $visibility=(this.options.checkVisibility)?':visible':'';images.filter('['+this.options.normalAttribute+']'+$visibility).each(function(){var $img=$(this);$img.addClass('visibility-hidden deferred-image');$img.attr('src',$img.attr($this.options.normalAttribute)).removeAttr($this.options.normalAttribute);if($img.hasClass('loading-image')){$img.removeClass('loading-image');}
$img.on('load',function(){$img.removeClass('visibility-hidden')});if($img.prop('complete')){$img.load();}});if(this.options.useResponsive){var attrToSearch=(this.isMobile)?this.options.mobileAttribute:this.options.desktopAttribute;images.filter('['+attrToSearch+']'+$visibility).each(function(){var $img=$(this);var $newSrc='';if($img.attr(attrToSearch)){$newSrc=$img.attr(attrToSearch);}
if(!$newSrc){$newSrc=$img.attr($this.options.normalAttribute);}
if($newSrc){$img.removeClass('no-src');if($newSrc!=$img.attr('src')){$img.addClass('visibility-hidden deferred-image');$img.attr('src',$newSrc);if($img.hasClass('loading-image')){$img.removeClass('loading-image');}
$img.on('load',function(){$img.removeClass('visibility-hidden')});if($img.prop('complete')){$img.load();}}}else{$img.addClass('no-src')}});}
this.element.removeClass(this.options.deferClass);this.element.addClass(this.options.deferredClass);}});return $.mage.loadImages;});
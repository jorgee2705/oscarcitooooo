define(['jquery','underscore','mage/utils/wrapper','Lineadirecta_GoogleTagManager/js/model/google-tag-manager-data-resolver'],function($,_,wrapper,googleTagManagerDataResolver){'use strict';return function(GoogleAnalyticsUniversal){GoogleAnalyticsUniversal.prototype.addToCart=function(product,item,userId){this.dataLayer.push({'userid':userId,'event':'add_to_cart','ecommerce':{'currency':this.dlCurrencyCode,'items':[item]}});};GoogleAnalyticsUniversal.prototype.removeFromCart=function(product,item,userId){this.dataLayer.push({'userid':userId,'event':'remove_from_cart','ecommerce':{'currency':this.dlCurrencyCode,'items':[item]}});};GoogleAnalyticsUniversal.prototype.updatePromotions=function(){var promotions,self=this;const promotionZoneClass='promotion-zone',promotionNamespaceClass='promotion-space',promotionStrategyClass='promotion-strategy';promotions=$('[class*="'+promotionZoneClass+'"]');if(promotions.length){_.each(promotions,function(banner){var dlPromotions={'userid':googleTagManagerDataResolver.getUserId(),'event':'view_promotion','ecommerce':{'items':[]}},position=1,promotionZone=self.findNameFromClasses(banner,promotionZoneClass),promotionNamespace=self.findNameFromClasses(banner,promotionNamespaceClass),promotionStrategyItems=$(banner).find('[class*="'+promotionStrategyClass+'"]');promotionStrategyItems.each(function(index,element){var promotionName=self.findNameFromClasses(this,promotionStrategyClass);dlPromotions.ecommerce.items.push({'promotion_name':promotionName,'creative_name':promotionZone,'creative_slot':promotionNamespace,'index':position});var bannerLinks=$(this).find('a');(function(bannerIndex){bannerLinks.each(function(index,element){$(element).on('click',function(elem){self.dataLayer.push({'output':$(this).attr('href'),'userid':googleTagManagerDataResolver.getUserId(),'event':'select_promotion','ecommerce':{'items':[{'promotion_name':promotionName,'creative_name':promotionZone,'creative_slot':promotionNamespace,'index':bannerIndex}]}});});});})(position);position++;});if(promotionStrategyItems.length){self.dataLayer.push(dlPromotions);}});}};GoogleAnalyticsUniversal.prototype.findNameFromClasses=function(elem,pattern){var name='',searchCriteria;searchCriteria=function(item){return item.indexOf(pattern)!==-1;};if($(elem).is('[class*="'+pattern+'"]')){var arrayClasses=$(elem).attr("class").split(' '),className=_.find(arrayClasses,searchCriteria);if(className){name=className.replace(pattern+'-','');}}
return name;};GoogleAnalyticsUniversal.prototype.activeOnCategory=function(id,name,category,list,position){return this;}
GoogleAnalyticsUniversal.prototype.activeOnProducts=function(id,name,list,position,category){return this;}
return GoogleAnalyticsUniversal;};});
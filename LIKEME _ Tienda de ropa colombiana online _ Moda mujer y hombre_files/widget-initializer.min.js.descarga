define(['underscore','jquery','mage/apply/main','Magento_Ui/js/lib/view/utils/dom-observer','Magento_PageBuilder/js/utils/breakpoints','matchMedia'],function(_,$,mage,domObserver,breakpointsUtils){'use strict';function getCurrentViewport(breakpoints,currentViewport){if(!currentViewport){_.each(breakpoints,function(breakpoint,viewport){if(!currentViewport&&matchMedia(breakpointsUtils.buildMedia(breakpoint.conditions)).matches){currentViewport=viewport;return true;}});}
return currentViewport;}
function initializeWidget(el,data,breakpoints,currentViewport){_.each(data,function(config,component){config=config||{};config.breakpoints=breakpoints;config.currentViewport=currentViewport;mage.applyFor(el,config,component);});}
return function(data,contextElement){if(!data.currentViewport){data.currentViewport=getCurrentViewport(data.breakpoints,data.currentViewport);}
_.each(data.config,function(componentConfiguration,elementPath){domObserver.get(elementPath,function(element){var $element=$(element);if(contextElement){$element=$(contextElement).find(element);}
if($element.length){initializeWidget($element,componentConfiguration,data.breakpoints,data.currentViewport);}});});};});
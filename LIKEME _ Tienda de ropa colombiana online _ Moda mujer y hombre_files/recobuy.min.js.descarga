define(['nostojs','jquery'],function(nostojs,$){'use strict';const Recobuy={};Recobuy.addProductToCart=function(productId,element,quantity=1){const productData={productId:productId,skuId:productId,quantity:quantity};return Recobuy.addSkuToCart(productData,element);};Recobuy.addMultipleProductsToCart=function(products,element){if(Array.isArray(products)){return products.reduce(function(acc,product){return acc.then(function(){return Recobuy.addSkuToCart(product,element)})},Promise.resolve())}else{Promise.reject(new Error("Products is not type array"))}};Recobuy.addSkuToCart=function(product,element){const quantity=product.quantity||1;const url=document.querySelector("#nosto_addtocart_form").getAttribute("action");const formKey=document.querySelector("#nosto_addtocart_form > input[name='form_key']").getAttribute("value");return new Promise(function(resolve,reject){$.ajax({url:url,type:'POST',data:{'form_key':formKey,'qty':quantity,'product':product.productId,'sku':product.skuId,},success:function(){Recobuy.sendCartEvent(element,product.productId)
return resolve()},error:function(){return reject()}})})};Recobuy.sendCartEvent=function(element,productId){if(typeof element==='object'&&element){const slotId=this.resolveContextSlotId(element);if(slotId){nostojs(function(api){api.recommendedProductAddedToCart(productId,slotId);});}}}
Recobuy.resolveContextSlotId=function(element){const m=20;let n=0;let e=element;while(typeof e.parentElement!=="undefined"&&e.parentElement){++n;e=e.parentElement;if(e.getAttribute('class')==='nosto_element'&&e.getAttribute('id')){return e.getAttribute('id');}
if(n>=m){return false;}}
return false;};return Recobuy;});